<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Object Detection App — Eric Kumi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root {
      --primary-bg: #121212;
      --secondary-bg: rgba(255, 255, 255, 0.1);
      --text-light: #e9ecef;
      --text-dark: #212529;
      --accent: #0d6efd;
    }
    body.light-mode {
      --primary-bg: #f8f9fa;
      --secondary-bg: rgba(0, 0, 0, 0.05);
      --text-light: #212529;
      --text-dark: #212529;
    }
    body {
      background-color: var(--primary-bg);
      color: var(--text-light);
      padding-top: 70px;
      transition: background 0.5s, color 0.5s;
    }
    canvas {
      border: 2px solid var(--accent);
      border-radius: 8px;
      max-width: 100%;
      margin-top: 10px;
      background: #000;
    }
    footer {
      margin-top: 50px;
      padding: 20px;
      background-color: #212529;
      color: white;
      text-align: center;
    }
    /* Glassmorphism card */
    .glass {
      background: var(--secondary-bg);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      padding: 20px;
    }
    /* Animated gradient buttons */
    .btn-gradient {
      background: linear-gradient(270deg, #0d6efd, #6610f2, #20c997);
      background-size: 600% 600%;
      animation: gradientShift 6s ease infinite;
      border: none;
      color: #fff !important;
    }
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    /* Contact form */
    .contact-form input, .contact-form textarea {
      border-radius: 8px;
    }
    .contact-form button {
      border-radius: 20px;
    }
    /* Particle canvas */
    #particles {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      z-index: -1;
      pointer-events: none;
    }
  </style>
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
    <div class="container-fluid">
      <a class="navbar-brand fw-bold" href="#">Eric Kumi</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link active" href="#">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="#demo">Demo</a></li>
          <li class="nav-item"><a class="nav-link" href="#contact">Contact</a></li>
          <li class="nav-item">
            <button id="toggleTheme" class="btn btn-sm btn-outline-light ms-3">🌙</button>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Particle background -->
  <canvas id="particles"></canvas>

  <!-- Main Content -->
  <div class="container" id="demo">
    <div class="glass shadow-lg">
      <h1 class="text-center mb-4">🚀 Real-Time Object Detection</h1>

      <!-- Controls -->
      <div class="mb-3 text-center">
        <button id="startWebcam" class="btn btn-gradient me-2">Start Webcam</button>
        <input type="file" id="uploadImage" accept="image/*" class="form-control-file d-inline">
        <button id="detectImage" class="btn btn-gradient ms-2">Detect on Image</button>
      </div>

      <!-- Confidence Threshold -->
      <div class="mb-3 text-center">
        <label for="confidence" class="form-label">Confidence Threshold: <span id="confValue">0.5</span></label>
        <input type="range" class="form-range w-50 mx-auto" min="0" max="1" step="0.05" id="confidence" value="0.5">
      </div>

      <!-- Webcam & Canvas -->
      <div class="text-center">
        <video id="video" autoplay muted playsinline class="d-none"></video>
        <canvas id="canvas"></canvas>
      </div>

      <!-- Stats -->
      <div class="text-center mt-3">
        <span id="stats" class="badge bg-secondary">FPS: -- | Time: -- ms</span>
      </div>
    </div>
  </div>

  <!-- Contact Section -->
  <div class="container mt-5" id="contact">
    <div class="glass shadow-lg">
      <h2 class="mb-3">📬 Contact Me</h2>
      <form class="contact-form">
        <div class="mb-3">
          <input type="text" class="form-control" placeholder="Your Name" required>
        </div>
        <div class="mb-3">
          <input type="email" class="form-control" placeholder="Your Email" required>
        </div>
        <div class="mb-3">
          <textarea class="form-control" rows="4" placeholder="Your Message"></textarea>
        </div>
        <button type="submit" class="btn btn-gradient">Send Message</button>
      </form>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <p>© <span id="year"></span> Eric Kumi | Object Detection Web App</p>
    <p class="small">Powered by TensorFlow.js & Bootstrap</p>
  </footer>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // Elements
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const startWebcam = document.getElementById('startWebcam');
    const uploadImage = document.getElementById('uploadImage');
    const detectImageBtn = document.getElementById('detectImage');
    const confidenceSlider = document.getElementById('confidence');
    const confValue = document.getElementById('confValue');
    const statsEl = document.getElementById('stats');
    const toggleTheme = document.getElementById('toggleTheme');
    let model, currentStream, frameTimes = [];

    // Load Model
    cocoSsd.load().then(m => { model = m; console.log("✅ Model loaded!"); });

    // Webcam
    startWebcam.addEventListener('click', async () => {
      if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
        currentStream = await navigator.mediaDevices.getUserMedia({ video: true });
        video.srcObject = currentStream;
        video.classList.remove('d-none');
        detectFrame();
      }
    });

    // Detect Frame
    async function detectFrame() {
      const t0 = performance.now();
      const predictions = await model.detect(video);
      renderPredictions(predictions);
      const t1 = performance.now();
      updateStats(t1 - t0);
      requestAnimationFrame(detectFrame);
    }

    // Stats smoothing
    function updateStats(time) {
      frameTimes.push(time);
      if (frameTimes.length > 30) frameTimes.shift();
      const avgTime = frameTimes.reduce((a,b) => a+b, 0) / frameTimes.length;
      const fps = (1000 / avgTime).toFixed(1);
      statsEl.textContent = `FPS: ${fps} | Time: ${avgTime.toFixed(1)} ms`;
    }

    // Render predictions
    function renderPredictions(predictions) {
      const threshold = parseFloat(confidenceSlider.value);
      confValue.textContent = threshold.toFixed(2);
      canvas.width = video.videoWidth || 640;
      canvas.height = video.videoHeight || 480;
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

      predictions.forEach(p => {
        if (p.score >= threshold) {
          ctx.strokeStyle = "#0d6efd";
          ctx.lineWidth = 2;
          ctx.strokeRect(...p.bbox);

          ctx.fillStyle = "#0d6efd";
          ctx.font = "16px Arial";
          ctx.fillText(`${p.class} ${(p.score*100).toFixed(1)}%`, p.bbox[0], p.bbox[1] > 20 ? p.bbox[1]-5 : 20);
        }
      });
    }

    // Image upload detection
    detectImageBtn.addEventListener('click', () => {
      const file = uploadImage.files[0];
      if (!file) return alert("Upload an image first.");
      const reader = new FileReader();
      reader.onload = () => {
        const img = new Image();
        img.onload = () => {
          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0);
          model.detect(img).then(renderPredictions);
        };
        img.src = reader.result;
      };
      reader.readAsDataURL(file);
    });

    // Dark/Light toggle
    toggleTheme.addEventListener('click', () => {
      document.body.classList.toggle('light-mode');
      localStorage.setItem('theme', document.body.classList.contains('light-mode') ? 'light' : 'dark');
      toggleTheme.textContent = document.body.classList.contains('light-mode') ? "☀️" : "🌙";
    });

    // Restore saved theme + slider
    window.onload = () => {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'light') document.body.classList.add('light-mode');
      toggleTheme.textContent = savedTheme === 'light' ? "☀️" : "🌙";

      const savedConf = localStorage.getItem('confidence');
      if (savedConf) { confidenceSlider.value = savedConf; confValue.textContent = savedConf; }
    };
    confidenceSlider.addEventListener('input', () => {
      localStorage.setItem('confidence', confidenceSlider.value);
    });

    // Footer year
    document.getElementById("year").textContent = new Date().getFullYear();

    // Dynamic Particles
    const pCanvas = document.getElementById('particles');
    const pCtx = pCanvas.getContext('2d');
    pCanvas.width = window.innerWidth;
    pCanvas.height = window.innerHeight;
    let particles = Array.from({length: 40}, () => ({
      x: Math.random()*pCanvas.width,
      y: Math.random()*pCanvas.height,
      r: Math.random()*3+1,
      dx: (Math.random()-0.5)*0.5,
      dy: (Math.random()-0.5)*0.5
    }));
    function animateParticles() {
      pCtx.clearRect(0,0,pCanvas.width,pCanvas.height);
      pCtx.fillStyle = "rgba(255,255,255,0.6)";
      particles.forEach(p => {
        pCtx.beginPath();
        pCtx.arc(p.x, p.y, p.r, 0, Math.PI*2);
        pCtx.fill();
        p.x += p.dx; p.y += p.dy;
        if (p.x<0 || p.x>pCanvas.width) p.dx*=-1;
        if (p.y<0 || p.y>pCanvas.height) p.dy*=-1;
      });
      requestAnimationFrame(animateParticles);
    }
    animateParticles();
    window.onresize = () => { pCanvas.width=window.innerWidth; pCanvas.height=window.innerHeight; };
  </script>
</body>
</html>
